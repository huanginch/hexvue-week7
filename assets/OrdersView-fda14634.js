import{_ as y,k as m,l as a,S as i,T as e,$ as r,U as l,V as P,X as h,W as O,a2 as U,a0 as M,R as A,a1 as p}from"./index-5da66a8b.js";import{a as E}from"./authStore-613f6c38.js";import{b as k,v as C}from"./runtime-dom.esm-bundler-1924b5fb.js";import{D as T,P as N,a as D}from"./PageLoading-20c7d6dc.js";const S={name:"orderModal",props:["order"],data(){return{modal:null,tempOrder:{products:{},user:{}}}},watch:{order:{handler(){this.tempOrder=JSON.parse(JSON.stringify(this.order))},deep:!0}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},submit(){this.$emit("update-order",this.tempOrder)}},mounted(){this.modal=new window.bootstrap.Modal(document.getElementById("orderModal"))}},F={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},$={class:"modal-dialog modal-lg"},L={class:"modal-content rounded-0"},q={class:"modal-header rounded-0 bg-secondary text-white"},B={class:"modal-title",id:"orderModalLabel"},I=e("button",{type:"button",class:"btn-close bg-white rounded-0","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},J={class:"mb-3"},j=e("p",null,"訂購人",-1),H={class:"mb-3 d-flex justify-content-between"},z=e("label",{for:"orderUserName",class:"form-label"},"姓名",-1),W=e("label",{for:"orderUserEmail",class:"form-label"},"Email",-1),X=e("label",{for:"orderUserTel",class:"form-label"},"電話",-1),G=e("label",{for:"orderUserAddress",class:"form-label"},"地址",-1),K=e("hr",null,null,-1),Q={class:"mb-3"},Y=e("p",null,"訂購商品",-1),Z={class:"table text-center align-middle"},ee=e("thead",null,[e("tr",null,[e("th"),e("th",null,"商品名稱"),e("th",null,"數量"),e("th",null,"單價"),e("th",null,"小計")])],-1),se={type:"button",class:"btn"},te=e("td",{colspan:"4",class:"text-end"},"總計:",-1),oe={class:"mb-3"},le=e("label",{for:"orderMessage",class:"form-label"},"顧客留言",-1),re=["value"],ne={class:"mb-3 d-flex justify-content-between align-items-center"},de={class:"mb-0"},ae={class:"d-flex align-items-center"},ie=e("p",{class:"mb-0",style:{"min-width":"100px"}},"訂單狀態:",-1),me=e("option",{value:"0"},"已成立",-1),ce=e("option",{value:"1"},"未處理",-1),ue=e("option",{value:"2"},"已出貨",-1),_e=e("option",{value:"3"},"已完成",-1),he=[me,ce,ue,_e],pe={class:"mb-0"},ge=e("hr",null,null,-1),be={class:"mb-3"},fe=e("label",{for:"messages",class:"form-label"},"店家留言",-1),ve={class:"modal-footer"},Oe=e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 ",-1);function Me(d,s,x,V,t,_){const c=m("VField"),u=m("ErrorMessage"),g=m("iconify-icon"),b=m("VForm");return a(),i("div",F,[e("div",$,[e("div",L,[e("div",q,[e("h5",B,"訂單編號: "+r(t.tempOrder.id),1),I]),e("div",R,[l(b,{onSubmit:_.submit},{default:P(({errors:n})=>[e("div",J,[j,e("div",H,[e("div",null,[z,l(c,{name:"orderUserName",modelValue:t.tempOrder.user.name,"onUpdate:modelValue":s[0]||(s[0]=o=>t.tempOrder.user.name=o),type:"text",class:h(["form-control",{"is-invalid":n.orderUserName,"is-valid":!n.orderUserName&&t.tempOrder.user.name}]),id:"orderUserName",rules:"required"},null,8,["modelValue","class"]),l(u,{name:"orderUserName"})]),e("div",null,[W,l(c,{name:"orderUserEmail",modelValue:t.tempOrder.user.email,"onUpdate:modelValue":s[1]||(s[1]=o=>t.tempOrder.user.email=o),type:"text",class:h(["form-control",{"is-invalid":n.orderUserEmail,"is-valid":!n.orderUserEmail&&t.tempOrder.user.email}]),id:"orderUserEmail",rules:"email|required"},null,8,["modelValue","class"]),l(u,{name:"orderUserEmail"})]),e("div",null,[X,l(c,{name:"orderUserTel",modelValue:t.tempOrder.user.tel,"onUpdate:modelValue":s[2]||(s[2]=o=>t.tempOrder.user.tel=o),type:"text",class:h(["form-control",{"is-invalid":n.orderUserTel,"is-valid":!n.orderUserTel&&t.tempOrder.user.tel}]),id:"orderUserTel",rules:"numeric|required"},null,8,["modelValue","class"]),l(u,{name:"orderUserTel"})])]),G,l(c,{name:"orderUserAddress",modelValue:t.tempOrder.user.address,"onUpdate:modelValue":s[3]||(s[3]=o=>t.tempOrder.user.address=o),type:"text",class:h(["form-control",{"is-invalid":n.orderUserAddress,"is-valid":!n.orderUserAddress&&t.tempOrder.user.address}]),id:"orderUserAddress",rules:"required"},null,8,["modelValue","class"]),l(u,{name:"orderUserAddress"})]),K,e("div",Q,[Y,e("table",Z,[ee,e("tbody",null,[(a(!0),i(O,null,U(t.tempOrder.products,o=>(a(),i("tr",{key:o.id},[e("td",null,[e("button",se,[l(g,{icon:"material-symbols:delete-outline-sharp",class:"text-primary"})])]),e("td",null,r(o.product.title),1),e("td",null,r(o.qty),1),e("td",null,r(o.product.price),1),e("td",null,r(o.total),1)]))),128))]),e("tfoot",null,[e("tr",null,[te,e("td",null,r(t.tempOrder.total),1)])])])]),e("div",oe,[le,e("textarea",{name:"orderMessage",id:"orderMessage",class:"form-control",disabled:"",value:t.tempOrder.message},null,8,re)]),e("div",ne,[e("div",null,[e("p",de,"總數量: "+r(t.tempOrder.num),1)]),e("div",ae,[ie,M(e("select",{"onUpdate:modelValue":s[4]||(s[4]=o=>t.tempOrder.status=o),class:"form-select",default:"0","aria-label":"Default select example"},he,512),[[k,t.tempOrder.status]])]),e("p",pe,"付款狀態: "+r(t.tempOrder.is_paid?"已付款":"未付款"),1)]),ge,e("div",be,[fe,M(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=o=>t.tempOrder.messages=o),class:"form-control",id:"messages",rows:"3"},null,512),[[C,t.tempOrder.messages]])])]),_:1},8,["onSubmit"])]),e("div",ve,[Oe,e("button",{type:"button",class:"btn btn-secondary",onClick:s[6]||(s[6]=n=>{_.submit(),this.closeModal()})},"修改")])])])])}const ye=y(S,[["render",Me]]);const{VITE_APP_URL:f,VITE_APP_PATH:v}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"int-hexschool",BASE_URL:"/hexvue-week7/",MODE:"production",DEV:!1,PROD:!0},Ue={name:"OrdersView",data(){return{orders:[],order:{},pagination:{},message:"",delFunc:null,loading:!1,responseMessage:""}},methods:{getOrders(d=1){this.loading=!0,this.$http.get(`${f}/api/${v}/admin/orders?page=${d}`).then(s=>{this.loading=!1,this.orders=s.data.orders,this.pagination=s.data.pagination}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message})})},updateOrder(d){this.loading=!0,this.$http.put(`${f}/api/${v}/admin/order/${d.id}`,{data:d}).then(s=>{this.loading=!1,this.responseMessage=s.data.message,this.$swal.fire({icon:"success",title:"好耶",text:s.data.message}),this.getOrders()}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message})})},deleteOrder(d){this.loading=!0,this.$http.delete(`${f}/api/${v}/admin/order/${d}`).then(s=>{this.loading=!1,this.responseMessage=s.data.message,this.$swal.fire({icon:"success",title:"好耶",text:s.data.message}),this.getOrders()}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message})})},changePage(d){this.getOrders(d)},...A(E,["checkAuth"])},mounted(){this.checkAuth(),this.getOrders()},components:{orderModal:ye,DelConfirmModal:T,PaginationComponent:N,PageLoading:D}},xe={class:"container"},Ve=e("h1",null,"訂單管理",-1),we={class:"table text-center align-middle"},Pe=e("thead",null,[e("tr",null,[e("th",null,"訂單編號"),e("th",null,"訂單成立日期"),e("th",null,"訂購人"),e("th",null,"價格"),e("th",null,"狀態"),e("th",null,"編輯")])],-1),Ae={key:0},Ee={key:1},ke={key:2},Ce={key:3},Te=["onClick"],Ne=["onClick"];function De(d,s,x,V,t,_){const c=m("PaginationComponent"),u=m("orderModal"),g=m("DelConfirmModal"),b=m("PageLoading"),n=m("AlertModal");return a(),i(O,null,[e("div",xe,[Ve,e("table",we,[Pe,e("tbody",null,[(a(!0),i(O,null,U(t.orders,o=>(a(),i("tr",{key:o.id},[e("th",null,r(o.id),1),e("td",null,r(o.create_at),1),e("td",null,r(o.user.name),1),e("td",null,r(o.total),1),o.status==0?(a(),i("td",Ae,"已成立 ")):p("",!0),o.status==1?(a(),i("td",Ee,"未處理")):p("",!0),o.status==2?(a(),i("td",ke,"已出貨")):p("",!0),o.status==3?(a(),i("td",Ce,"已完成")):p("",!0),e("td",null,[e("button",{type:"button",class:"btn btn-secondary me-3",onClick:w=>{this.$refs.orderModal.openModal(),this.order=JSON.parse(JSON.stringify(o))}},"編輯",8,Te),e("button",{type:"button",class:"btn btn-outline-primary",onClick:w=>{this.$refs.delModal.openModal(),t.message=`確定要刪除訂單編號為${o.id}的訂單嗎?`,t.delFunc=_.deleteOrder.bind(this,o.id)}},"刪除",8,Ne)])]))),128))])]),l(c,{pages:t.pagination},null,8,["pages"])]),l(u,{ref:"orderModal",order:t.order,onUpdateOrder:_.updateOrder},null,8,["order","onUpdateOrder"]),l(g,{ref:"delModal",message:t.message,delFunc:t.delFunc},null,8,["message","delFunc"]),l(b,{active:t.loading},null,8,["active"]),l(n,{ref:"alertModal",message:t.responseMessage},null,8,["message"])],64)}const qe=y(Ue,[["render",De]]);export{qe as default};
