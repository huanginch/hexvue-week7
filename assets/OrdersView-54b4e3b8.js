import{_ as U,r as m,o as a,c as i,b as e,t as n,e as l,w as E,n as p,F as O,k as x,h as y,p as C,v as k,j as h}from"./index-72122788.js";import{D as A,P as N,a as T}from"./PageLoading-ea7e26bd.js";const D={name:"orderModal",props:["order"],data(){return{modal:null,tempOrder:{products:{},user:{}}}},watch:{order:{handler(){this.tempOrder=JSON.parse(JSON.stringify(this.order))},deep:!0}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},submit(){this.$emit("update-order",this.tempOrder)}},mounted(){this.modal=new window.bootstrap.Modal(document.getElementById("orderModal"))}},F={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},$={class:"modal-dialog modal-lg"},L={class:"modal-content rounded-0"},S={class:"modal-header rounded-0 bg-secondary text-white"},q={class:"modal-title",id:"orderModalLabel"},B=e("button",{type:"button",class:"btn-close bg-white rounded-0","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),I={class:"modal-body"},J={class:"mb-3"},R=e("p",null,"訂購人",-1),j={class:"mb-3 d-flex justify-content-between"},H=e("label",{for:"orderUserName",class:"form-label"},"姓名",-1),z=e("label",{for:"orderUserEmail",class:"form-label"},"Email",-1),G=e("label",{for:"orderUserTel",class:"form-label"},"電話",-1),K=e("label",{for:"orderUserAddress",class:"form-label"},"地址",-1),Q=e("hr",null,null,-1),W={class:"mb-3"},X=e("p",null,"訂購商品",-1),Y={class:"table text-center align-middle"},Z=e("thead",null,[e("tr",null,[e("th"),e("th",null,"商品名稱"),e("th",null,"數量"),e("th",null,"單價"),e("th",null,"小計")])],-1),ee={type:"button",class:"btn"},se=e("td",{colspan:"4",class:"text-end"},"總計:",-1),te={class:"mb-3"},oe=e("label",{for:"orderMessage",class:"form-label"},"顧客留言",-1),le=["value"],ne={class:"mb-3 d-flex justify-content-between align-items-center"},re={class:"mb-0"},de={class:"d-flex align-items-center"},ae=e("p",{class:"mb-0",style:{"min-width":"100px"}},"訂單狀態:",-1),ie=e("option",{value:"0"},"已成立",-1),me=e("option",{value:"1"},"未處理",-1),ue=e("option",{value:"2"},"已出貨",-1),ce=e("option",{value:"3"},"已完成",-1),_e=[ie,me,ue,ce],pe={class:"mb-0"},he=e("hr",null,null,-1),ge={class:"mb-3"},be=e("label",{for:"messages",class:"form-label"},"店家留言",-1),fe={class:"modal-footer"},ve=e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 ",-1);function Oe(d,s,V,w,t,_){const u=m("VField"),c=m("ErrorMessage"),g=m("iconify-icon"),b=m("VForm");return a(),i("div",F,[e("div",$,[e("div",L,[e("div",S,[e("h5",q,"訂單編號: "+n(t.tempOrder.id),1),B]),e("div",I,[l(b,{onSubmit:_.submit},{default:E(({errors:r})=>[e("div",J,[R,e("div",j,[e("div",null,[H,l(u,{name:"orderUserName",modelValue:t.tempOrder.user.name,"onUpdate:modelValue":s[0]||(s[0]=o=>t.tempOrder.user.name=o),type:"text",class:p(["form-control",{"is-invalid":r.orderUserName,"is-valid":!r.orderUserName&&t.tempOrder.user.name}]),id:"orderUserName",rules:"required"},null,8,["modelValue","class"]),l(c,{name:"orderUserName"})]),e("div",null,[z,l(u,{name:"orderUserEmail",modelValue:t.tempOrder.user.email,"onUpdate:modelValue":s[1]||(s[1]=o=>t.tempOrder.user.email=o),type:"text",class:p(["form-control",{"is-invalid":r.orderUserEmail,"is-valid":!r.orderUserEmail&&t.tempOrder.user.email}]),id:"orderUserEmail",rules:"email|required"},null,8,["modelValue","class"]),l(c,{name:"orderUserEmail"})]),e("div",null,[G,l(u,{name:"orderUserTel",modelValue:t.tempOrder.user.tel,"onUpdate:modelValue":s[2]||(s[2]=o=>t.tempOrder.user.tel=o),type:"text",class:p(["form-control",{"is-invalid":r.orderUserTel,"is-valid":!r.orderUserTel&&t.tempOrder.user.tel}]),id:"orderUserTel",rules:"numeric|required"},null,8,["modelValue","class"]),l(c,{name:"orderUserTel"})])]),K,l(u,{name:"orderUserAddress",modelValue:t.tempOrder.user.address,"onUpdate:modelValue":s[3]||(s[3]=o=>t.tempOrder.user.address=o),type:"text",class:p(["form-control",{"is-invalid":r.orderUserAddress,"is-valid":!r.orderUserAddress&&t.tempOrder.user.address}]),id:"orderUserAddress",rules:"required"},null,8,["modelValue","class"]),l(c,{name:"orderUserAddress"})]),Q,e("div",W,[X,e("table",Y,[Z,e("tbody",null,[(a(!0),i(O,null,x(t.tempOrder.products,o=>(a(),i("tr",{key:o.id},[e("td",null,[e("button",ee,[l(g,{icon:"material-symbols:delete-outline-sharp",class:"text-primary"})])]),e("td",null,n(o.product.title),1),e("td",null,n(o.qty),1),e("td",null,n(o.product.price),1),e("td",null,n(o.total),1)]))),128))]),e("tfoot",null,[e("tr",null,[se,e("td",null,n(t.tempOrder.total),1)])])])]),e("div",te,[oe,e("textarea",{name:"orderMessage",id:"orderMessage",class:"form-control",disabled:"",value:t.tempOrder.message},null,8,le)]),e("div",ne,[e("div",null,[e("p",re,"總數量: "+n(t.tempOrder.num),1)]),e("div",de,[ae,y(e("select",{"onUpdate:modelValue":s[4]||(s[4]=o=>t.tempOrder.status=o),class:"form-select",default:"0","aria-label":"Default select example"},_e,512),[[C,t.tempOrder.status]])]),e("p",pe,"付款狀態: "+n(t.tempOrder.is_paid?"已付款":"未付款"),1)]),he,e("div",ge,[be,y(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=o=>t.tempOrder.messages=o),class:"form-control",id:"messages",rows:"3"},null,512),[[k,t.tempOrder.messages]])])]),_:1},8,["onSubmit"])]),e("div",fe,[ve,e("button",{type:"button",class:"btn btn-secondary",onClick:s[6]||(s[6]=r=>{_.submit(),this.closeModal()})},"修改")])])])])}const Me=U(D,[["render",Oe]]);const{VITE_APP_URL:f,VITE_APP_PATH:v}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"int-hexschool",BASE_URL:"/hexvue-week7/",MODE:"production",DEV:!1,PROD:!0},ye={name:"OrdersView",data(){return{orders:[],order:{},pagination:{},message:"",delFunc:null,loading:!1,responseMessage:""}},methods:{getOrders(d=1){this.loading=!0,this.$http.get(`${f}/api/${v}/admin/orders?page=${d}`).then(s=>{this.loading=!1,this.orders=s.data.orders,this.pagination=s.data.pagination}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message}),s.response.status===401&&this.$router.push("/")})},updateOrder(d){this.loading=!0,this.$http.put(`${f}/api/${v}/admin/order/${d.id}`,{data:d}).then(s=>{this.loading=!1,this.responseMessage=s.data.message,this.$swal.fire({icon:"success",title:"好耶",text:s.data.message}),this.getOrders()}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message})})},deleteOrder(d){this.loading=!0,this.$http.delete(`${f}/api/${v}/admin/order/${d}`).then(s=>{this.loading=!1,this.responseMessage=s.data.message,this.$swal.fire({icon:"success",title:"好耶",text:s.data.message}),this.getOrders()}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message})})},changePage(d){this.getOrders(d)}},mounted(){this.getOrders()},components:{orderModal:Me,DelConfirmModal:A,PaginationComponent:N,PageLoading:T}},Ue={class:"container"},xe=e("h1",null,"訂單管理",-1),Ve={class:"table text-center align-middle"},we=e("thead",null,[e("tr",null,[e("th",null,"訂單編號"),e("th",null,"訂單成立日期"),e("th",null,"訂購人"),e("th",null,"價格"),e("th",null,"狀態"),e("th",null,"編輯")])],-1),Pe={key:0},Ee={key:1},Ce={key:2},ke={key:3},Ae=["onClick"],Ne=["onClick"];function Te(d,s,V,w,t,_){const u=m("PaginationComponent"),c=m("orderModal"),g=m("DelConfirmModal"),b=m("PageLoading"),r=m("AlertModal");return a(),i(O,null,[e("div",Ue,[xe,e("table",Ve,[we,e("tbody",null,[(a(!0),i(O,null,x(t.orders,o=>{var M;return a(),i("tr",{key:o.id},[e("th",null,n(o.id),1),e("td",null,n(o.create_at),1),e("td",null,n((M=o.user)==null?void 0:M.name),1),e("td",null,n(o.total),1),o.status==0?(a(),i("td",Pe,"已成立 ")):h("",!0),o.status==1?(a(),i("td",Ee,"未處理")):h("",!0),o.status==2?(a(),i("td",Ce,"已出貨")):h("",!0),o.status==3?(a(),i("td",ke,"已完成")):h("",!0),e("td",null,[e("button",{type:"button",class:"btn btn-secondary me-3",onClick:P=>{this.$refs.orderModal.openModal(),this.order=JSON.parse(JSON.stringify(o))}},"編輯",8,Ae),e("button",{type:"button",class:"btn btn-outline-primary",onClick:P=>{this.$refs.delModal.openModal(),t.message=`確定要刪除訂單編號為${o.id}的訂單嗎?`,t.delFunc=_.deleteOrder.bind(this,o.id)}},"刪除",8,Ne)])])}),128))])]),l(u,{pages:t.pagination},null,8,["pages"])]),l(c,{ref:"orderModal",order:t.order,onUpdateOrder:_.updateOrder},null,8,["order","onUpdateOrder"]),l(g,{ref:"delModal",message:t.message,delFunc:t.delFunc},null,8,["message","delFunc"]),l(b,{active:t.loading},null,8,["active"]),l(r,{ref:"alertModal",message:t.responseMessage},null,8,["message"])],64)}const $e=U(ye,[["render",Te]]);export{$e as default};
