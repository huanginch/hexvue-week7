import{_ as w,r as a,o as C,c as f,b as e,t as u,e as s,w as x,n as _,h as P,i as D,f as N,F as v,k}from"./index-6413ea26.js";import{P as $,D as E,a as T}from"./PageLoading-f833a274.js";const F={name:"CouponModal",props:["coupon","isNew"],data(){return{modal:null,tempCoupon:{is_enabled:1}}},watch:{tempCoupon:{handler(){this.tempCoupon.is_enabled=this.tempCoupon.is_enabled?1:0},deep:!0},coupon:{handler(){this.tempCoupon=JSON.parse(JSON.stringify(this.coupon)),console.log("coupon",this.coupon)},deep:!0}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},submit(){this.$emit("update-coupon",this.tempCoupon)}},mounted(){this.modal=new window.bootstrap.Modal(document.getElementById("couponModal"))}},U={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},A={class:"modal-dialog"},L={class:"modal-content rounded-0"},I={class:"modal-header bg-secondary rounded-0"},S={class:"modal-title text-white",id:"exampleModalLabel"},B=e("button",{type:"button",class:"btn-close bg-white rounded-0","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},O={class:"row"},R={class:"col-12"},H={class:"mb-3"},J=e("label",{for:"couponTitle",class:"mb-2"},"優惠券名稱",-1),z={class:"mb-3"},j=e("label",{for:"couponPercent",class:"form-label"},"折扣",-1),G={class:"mb-3"},K=e("label",{for:"couponDueDate",class:"form-label"},"到期日",-1),Q={class:"mb-3"},W=e("label",{for:"couponCode",class:"form-label"},"優惠代碼",-1),X=["value"],Y=e("label",{class:"form-check-label",for:"orderIsEnabled"}," 是否啟用 ",-1),Z={class:"modal-footer"},ee=e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 ",-1);function oe(d,o,r,m,t,h){const c=a("VField"),p=a("ErrorMessage"),M=a("VForm");return C(),f("div",U,[e("div",A,[e("div",L,[e("div",I,[e("h5",S,u(r.isNew?"新增優惠券":`優惠券編號: ${t.tempCoupon.id}`),1),B]),e("div",q,[s(M,{onSubmit:h.submit},{default:x(({errors:n})=>[e("div",O,[e("div",R,[e("div",H,[J,s(c,{id:"couponTitle",name:"couponTitle",type:"text",rules:"required",class:_(["form-control mb-1",{"is-invalid":n.couponTitle,"is-valid":!n.couponTitle&&t.tempCoupon.title}]),placeholder:"請輸入產品名稱",modelValue:t.tempCoupon.title,"onUpdate:modelValue":o[0]||(o[0]=l=>t.tempCoupon.title=l)},null,8,["class","modelValue"]),s(p,{name:"couponTitle"})]),e("div",z,[j,s(c,{name:"couponPercent",modelValue:t.tempCoupon.percent,"onUpdate:modelValue":o[1]||(o[1]=l=>t.tempCoupon.percent=l),modelModifiers:{number:!0},type:"number",min:"1",class:_(["form-control",{"is-invalid":n.couponPercent,"is-valid":!n.couponPercent&&t.tempCoupon.percent}]),id:"couponPercent",rules:"numeric|required"},null,8,["modelValue","class"]),s(p,{name:"couponPercent"})]),e("div",G,[K,s(c,{name:"couponDueDate",modelValue:t.tempCoupon.due_date,"onUpdate:modelValue":o[2]||(o[2]=l=>t.tempCoupon.due_date=l),modelModifiers:{number:!0},type:"number",class:_(["form-control",{"is-invalid":n.couponDueDate,"is-valid":!n.couponDueDate&&t.tempCoupon.udue_date}]),id:"couponDueDate",rules:"numeric|required"},null,8,["modelValue","class"]),s(p,{name:"couponDueDate"})]),e("div",Q,[W,s(c,{name:"couponCode",modelValue:t.tempCoupon.code,"onUpdate:modelValue":o[3]||(o[3]=l=>t.tempCoupon.code=l),type:"text",class:_(["form-control",{"is-invalid":n.couponCode,"is-valid":!n.couponCode&&t.tempCoupon.code}]),id:"couponCode",rules:"required"},null,8,["modelValue","class"]),s(p,{name:"couponCode"})]),e("div",null,[P(e("input",{"onUpdate:modelValue":o[4]||(o[4]=l=>t.tempCoupon.is_enabled=l),class:"form-check-input me-2",type:"checkbox",value:t.tempCoupon.is_enabled,id:"orderIsEnabled"},null,8,X),[[D,t.tempCoupon.is_enabled,void 0,{number:!0}]]),Y])])])]),_:1},8,["onSubmit"])]),e("div",Z,[ee,e("button",{type:"button",class:"btn btn-secondary",onClick:o[5]||(o[5]=n=>{h.submit(),this.closeModal()})},u(r.isNew?"新增":"修改"),1)])])])])}const te=w(F,[["render",oe]]);const{VITE_APP_URL:b,VITE_APP_PATH:g}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"int-hexschool",BASE_URL:"/hexvue-week7/",MODE:"production",DEV:!1,PROD:!0},se={name:"CouponsView",data(){return{coupons:{},coupon:{},pagination:{},isNew:!0,message:"",delFunc:null,loading:!1,responseMessage:""}},methods:{getCoupons(d=1){this.loading=!0,this.$http.get(`${b}/api/${g}/admin/coupons?page=${d}`).then(o=>{this.loading=!1,this.coupons=o.data.coupons,this.pagination=o.data.pagination}).catch(o=>{this.loading=!1,this.responseMessage=o.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage}),o.response.status===401&&this.$router.push("/")})},updateCoupon(d){this.loading=!0;const o=this.isNew?`${b}/api/${g}/admin/coupon`:`${b}/api/${g}/admin/coupon/${d.id}`,r=this.isNew?"post":"put";this.$http[r](o,{data:d}).then(m=>{this.loading=!1,this.responseMessage=m.data.message,this.$swal.fire({icon:"success",title:"好耶",text:this.responseMessage}),this.getCoupons()}).catch(m=>{this.loading=!1,this.responseMessage=m.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage})})},deleteCoupon(d){this.loading=!0,this.$http.delete(`${b}/api/${g}/admin/coupon/${d}`).then(o=>{this.loading=!1,this.responseMessage=o.data.message,this.$swal.fire({icon:"success",title:"好耶",text:this.responseMessage}),this.getCoupons()}).catch(o=>{this.loading=!1,this.responseMessage=o.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage})})}},mounted(){this.getCoupons()},components:{CouponModal:te,Pagination:$,DeleteModal:E,PageLoading:T}},ne={class:"container"},le=e("h1",null,"優惠券管理",-1),ie={class:"table text-center align-middle"},ae=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"名稱"),e("th",null,"折扣"),e("th",null,"到期日"),e("th",null,"優惠碼"),e("th",null,"數量"),e("th",null,"編輯")])],-1),de=["onClick"],ue=["onClick"];function ce(d,o,r,m,t,h){const c=a("iconify-icon"),p=a("CouponModal"),M=a("DeleteModal"),n=a("Pagination"),l=a("PageLoading"),V=a("AlertModal");return C(),f(v,null,[e("div",ne,[le,e("button",{type:"button",class:"btn btn-secondary float-end text-white align-items-center",onClick:o[0]||(o[0]=i=>{this.$refs.cModal.openModal(),this.coupon={},this.isNew=!0})},[s(c,{icon:"material-symbols:add"}),N(" 新增產品 ")]),e("table",ie,[ae,e("tbody",null,[(C(!0),f(v,null,k(t.coupons,i=>(C(),f("tr",{key:i.id},[e("td",null,u(i.id),1),e("td",null,u(i.title),1),e("td",null,u(i.percent),1),e("td",null,u(i.due_date),1),e("td",null,u(i.code),1),e("th",null,u(i.num),1),e("td",null,[e("button",{class:"btn btn-secondary me-3",onClick:y=>{this.$refs.cModal.openModal(),this.coupon=i,this.isNew=!1}},"編輯",8,de),e("button",{class:"btn btn-outline-primary",onClick:y=>{this.$refs.delModal.openModal(),t.message=`確定要刪除優惠券${i.title}嗎?`,t.delFunc=h.deleteCoupon.bind(this,i.id)}},"刪除",8,ue)])]))),128))])])]),s(p,{ref:"cModal",coupon:t.coupon,isNew:t.isNew,onUpdateCoupon:h.updateCoupon},null,8,["coupon","isNew","onUpdateCoupon"]),s(M,{ref:"delModal",message:t.message,delFunc:t.delFunc},null,8,["message","delFunc"]),s(n,{pages:t.pagination},null,8,["pages"]),s(l,{active:t.loading},null,8,["active"]),s(V,{ref:"alertModal",message:t.responseMessage},null,8,["message"])],64)}const me=w(se,[["render",ce]]);export{me as default};
