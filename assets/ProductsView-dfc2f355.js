import{_ as U,o as p,c as h,b as e,n as m,r as g,t as b,e as l,w as C,h as x,v as A,i as k,j as M,F as w,k as I,f as T}from"./index-89c837cb.js";import{D as E,P as N,a as O}from"./PageLoading-67a4ee26.js";const D={name:"SmallLoading",props:["active"]},L={class:"small-loading"},F=e("span",{class:"visually-hidden"},"Loading...",-1),B=[F];function S(d,o,_,r,t,u){return p(),h("div",L,[e("div",{class:m(["spinner-border text-success",{"d-none":!_.active}]),role:"status"},B,2)])}const q=U(D,[["render",S]]);const{VITE_APP_URL:R,VITE_APP_PATH:j}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"int-hexschool",BASE_URL:"/hexvue-week7/",MODE:"production",DEV:!1,PROD:!0},H={name:"ProductModal",props:["product","isNew"],data(){return{modal:null,tempProduct:{},showAddImgBtn:!0,loadingImg:!1,message:""}},watch:{product(){this.tempProduct=JSON.parse(JSON.stringify(this.product))},tempProduct:{handler(){if(this.tempProduct.imagesUrl===void 0){this.tempProduct.imagesUrl=[];return}this.tempProduct.imagesUrl.length>=5?this.showAddImgBtn=!1:this.showAddImgBtn=!0},deep:!0}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},removeOtherImg(d){this.tempProduct.imagesUrl.splice(d,1)},submit(){this.$emit("update-product",this.tempProduct)},uploadImg(){this.loadingImg=!0;const d=document.getElementById("inputGroupFile01").files[0],o=new FormData;o.append("file-to-upload",d);const _=`${R}/api/${j}/admin/upload`;this.$http.post(_,o,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{this.loadingImg=!1,r.data.success&&(this.tempProduct.imageUrl=r.data.imageUrl)}).catch(r=>{this.loadingImg=!1,this.message=r.response.data.message,this.$swal(this.message)})}},mounted(){this.modal=new window.bootstrap.Modal(document.getElementById("productModal"))},components:{smallLoading:q}},G={class:"modal fade",id:"productModal",tabindex:"-1","data-bs-backdrop":"static","aria-labelledby":"productModalLabel","aria-hidden":"true"},J={class:"modal-dialog modal-xl"},$={class:"modal-content rounded-0"},z={class:"modal-header bg-secondary rounded-0"},K={class:"modal-title text-white",id:"exampleModalLabel"},Q=e("button",{type:"button",class:"btn-close bg-white rounded-0","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),W={class:"modal-body"},X={class:"row"},Y={class:"col-6"},Z={class:"mb-3"},ee=e("label",{for:"productTitle",class:"mb-2"},"產品名稱",-1),te={class:"mb-3 d-flex justify-content-between"},oe=e("label",{for:"productCategory",class:"form-label"},"分類",-1),se=e("label",{for:"productUnit",class:"form-label"},"單位",-1),le={class:"mb-3 d-flex justify-content-between"},ie=e("label",{for:"productOriginPrice",class:"form-label"},"原價",-1),ne=e("label",{for:"productPriice",class:"form-label"},"售價",-1),de={class:"mb-3 d-flex justify-content-between"},ae=e("label",{for:"productCountry",class:"form-label"},"產地",-1),re=e("label",{for:"productAbv",class:"form-label"},"酒精濃度",-1),ce={class:"mb-3 d-flex justify-content-between"},ue=e("label",{for:"productVolume",class:"form-label"},"容量",-1),me=e("hr",null,null,-1),pe={class:"mb-3"},he=e("label",{for:"productDescription",class:"form-label"},"產品描述",-1),ge={class:"mb-3"},_e=["value"],be=e("label",{class:"form-check-label",for:"productIsEnabled"}," 是否啟用 ",-1),Pe={class:"col-6"},fe={class:"mb-3"},ve=e("label",{for:"productMainImg",class:"form-label"},"主要圖片",-1),ye={class:"d-flex align-items-center custom-file mb-2"},Ve=e("label",{class:"custom-file-label bg-secondary px-3 py-2",for:"inputGroupFile01"},"選擇檔案",-1),Me=["src"],we={class:"mb-3"},Ue=e("h3",null,"其他圖片",-1),xe=e("label",{for:"productOtherImg",class:"form-label"},"圖片網址",-1),Ie=["src","alt"],Ce=["onClick"],Ae={class:"modal-footer"},ke=e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 ",-1);function Te(d,o,_,r,t,u){const a=g("VField"),c=g("ErrorMessage"),y=g("smallLoading"),V=g("VForm");return p(),h("div",G,[e("div",J,[e("div",$,[e("div",z,[e("h5",K,b(_.isNew?"新增產品":`產品編號: ${t.tempProduct.id}`),1),Q]),e("div",W,[l(V,{onSubmit:u.submit},{default:C(({errors:i})=>[e("div",X,[e("div",Y,[e("div",Z,[ee,l(a,{id:"productTitle",name:"productTitle",type:"text",rules:"required",class:m(["form-control mb-1",{"is-invalid":i.productTitle,"is-valid":!i.productTitle&&t.tempProduct.title}]),placeholder:"請輸入產品名稱",modelValue:t.tempProduct.title,"onUpdate:modelValue":o[0]||(o[0]=s=>t.tempProduct.title=s)},null,8,["class","modelValue"]),l(c,{name:"productTitle"})]),e("div",te,[e("div",null,[oe,l(a,{name:"productCategory",modelValue:t.tempProduct.category,"onUpdate:modelValue":o[1]||(o[1]=s=>t.tempProduct.category=s),type:"text",class:m(["form-control",{"is-invalid":i.productCategory,"is-valid":!i.productCategory&&t.tempProduct.category}]),id:"productCategory",rules:"required"},null,8,["modelValue","class"]),l(c,{name:"productCategory"})]),e("div",null,[se,l(a,{name:"productUnit",modelValue:t.tempProduct.unit,"onUpdate:modelValue":o[2]||(o[2]=s=>t.tempProduct.unit=s),type:"text",class:m(["form-control",{"is-invalid":i.productUnit,"is-valid":!i.productUnit&&t.tempProduct.unit}]),id:"productUnit",rules:"required"},null,8,["modelValue","class"]),l(c,{name:"productUnit"})])]),e("div",le,[e("div",null,[ie,l(a,{name:"productOriginPrice",modelValue:t.tempProduct.origin_price,"onUpdate:modelValue":o[3]||(o[3]=s=>t.tempProduct.origin_price=s),modelModifiers:{number:!0},type:"number",min:"0",class:m(["form-control",{"is-invalid":i.productOriginPrice,"is-valid":!i.productOriginPrice&&t.tempProduct.origin_price}]),id:"productOriginPrice",rules:"numeric|required"},null,8,["modelValue","class"]),l(c,{name:"productOriginPrice"})]),e("div",null,[ne,l(a,{name:"productPrice",modelValue:t.tempProduct.price,"onUpdate:modelValue":o[4]||(o[4]=s=>t.tempProduct.price=s),modelModifiers:{number:!0},type:"number",min:"0",class:m(["form-control",{"is-invalid":i.productPrice,"is-valid":!i.productPrice&&t.tempProduct.price}]),id:"productPrice",rules:"numeric|required"},null,8,["modelValue","class"]),l(c,{name:"productPrice"})])]),e("div",de,[e("div",null,[ae,l(a,{name:"productCountry",modelValue:t.tempProduct.country,"onUpdate:modelValue":o[5]||(o[5]=s=>t.tempProduct.country=s),type:"text",class:m(["form-control",{"is-invalid":i.productCountry,"is-valid":!i.productCountry&&t.tempProduct.country}]),id:"productCountry",rules:"required"},null,8,["modelValue","class"]),l(c,{name:"productCountry"})]),e("div",null,[re,l(a,{name:"productAbv",modelValue:t.tempProduct.abv,"onUpdate:modelValue":o[6]||(o[6]=s=>t.tempProduct.abv=s),type:"text",class:m(["form-control",{"is-invalid":i.productAbv,"is-valid":!i.productAbv&&t.tempProduct.abv}]),id:"productAbv",rules:"required"},null,8,["modelValue","class"]),l(c,{name:"productAbv"})])]),e("div",ce,[e("div",null,[ue,l(a,{name:"productVolume",modelValue:t.tempProduct.capacity,"onUpdate:modelValue":o[7]||(o[7]=s=>t.tempProduct.capacity=s),type:"text",class:m(["form-control",{"is-invalid":i.productVolume,"is-valid":!i.productVolume&&t.tempProduct.capacity}]),id:"productVolume",rules:"required"},null,8,["modelValue","class"]),l(c,{name:"productVolume"})])]),me,e("div",pe,[he,x(e("textarea",{"onUpdate:modelValue":o[8]||(o[8]=s=>t.tempProduct.description=s),class:"form-control",id:"productDescription",rows:"3"},null,512),[[A,t.tempProduct.description]])]),e("div",ge,[x(e("input",{"onUpdate:modelValue":o[9]||(o[9]=s=>t.tempProduct.is_enabled=s),class:"form-check-input me-2",type:"checkbox",value:t.tempProduct.is_enabled,id:"productIsEnabled"},null,8,_e),[[k,t.tempProduct.is_enabled]]),be])]),e("div",Pe,[e("div",fe,[ve,l(a,{name:"productMainImg",modelValue:t.tempProduct.imageUrl,"onUpdate:modelValue":o[10]||(o[10]=s=>t.tempProduct.imageUrl=s),class:m(["form-control mb-2",{"is-invalid":i.productMainImg,"is-valid":!i.productMainImg&&t.tempProduct.imageUrl}]),type:"text",id:"productMainImg",placeholder:"請輸入圖片連結或上傳圖片",rules:"required"},null,8,["modelValue","class"]),e("div",ye,[e("div",null,[Ve,e("input",{onChange:o[11]||(o[11]=(...s)=>u.uploadImg&&u.uploadImg(...s)),ref:"file",type:"file",class:"custom-file-input rounded-end",accept:"image/*",id:"inputGroupFile01","aria-describedby":"inputGroupFileAddon01"},null,544)]),l(y,{active:t.loadingImg},null,8,["active"])]),t.tempProduct.imageUrl?(p(),h("img",{key:0,src:t.tempProduct.imageUrl,alt:"main_image",class:"img-fluid"},null,8,Me)):M("",!0),l(c,{name:"productMainImg"})]),e("div",we,[Ue,(p(!0),h(w,null,I(t.tempProduct.imagesUrl,(s,n)=>(p(),h("div",{class:"mb-3",key:n},[xe,l(a,{name:"productOtherImg",modelValue:t.tempProduct.imagesUrl[n],"onUpdate:modelValue":P=>t.tempProduct.imagesUrl[n]=P,class:"form-control mb-2",type:"text",id:"productOtherImg",placeholder:"請輸入圖片連結"},null,8,["modelValue","onUpdate:modelValue"]),s?(p(),h("img",{key:0,src:s,alt:n,class:"img-fluid mb-2"},null,8,Ie)):M("",!0),e("button",{type:"button",class:"btn btn-outline-primary w-25",onClick:P=>u.removeOtherImg(n)},"刪除",8,Ce)]))),128)),t.showAddImgBtn?(p(),h("button",{key:0,type:"button",class:"btn btn-outline-secondary w-25",onClick:o[12]||(o[12]=s=>{this.tempProduct.imagesUrl.push("")})},"新增圖片")):M("",!0)])])])]),_:1},8,["onSubmit"])]),e("div",Ae,[ke,e("button",{type:"button",class:"btn btn-secondary",onClick:o[13]||(o[13]=i=>{u.submit(),this.hideModal()})},b(_.isNew?"新增":"修改"),1)])])])])}const Ee=U(H,[["render",Te]]);const{VITE_APP_URL:f,VITE_APP_PATH:v}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"int-hexschool",BASE_URL:"/hexvue-week7/",MODE:"production",DEV:!1,PROD:!0},Ne={name:"ProductsView",data(){return{products:{},product:{},isNew:!0,pagination:{},message:"",delFunc:null,loading:!1,responseMessage:""}},methods:{getProducts(d=1){this.loading=!0,this.$http.get(`${f}/api/${v}/admin/products?page=${d}`).then(o=>{this.loading=!1,this.products=o.data.products,this.pagination=o.data.pagination}).catch(o=>{this.loading=!1,this.responseMessage=o.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage}),o.response.status===401&&this.$router.push("/")})},updateProduct(d){this.loading=!0;const o=this.isNew?`${f}/api/${v}/admin/product`:`${f}/api/${v}/admin/product/${d.id}`,_=this.isNew?"post":"put";this.$http[_](o,{data:d}).then(r=>{this.loading=!1,this.responseMessage=r.data.message,this.$swal.fire({icon:"success",title:"好耶",text:this.responseMessage}),this.getProducts()}).catch(r=>{this.loading=!1,this.responseMessage=r.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage})})},deleteProduct(d){this.loading=!0,this.$http.delete(`${f}/api/${v}/admin/product/${d}`).then(o=>{this.loading=!1,this.responseMessage=o.data.message,this.$swal.fire({icon:"success",title:"好耶",text:this.responseMessage}),this.getProducts()}).catch(o=>{this.loading=!1,this.responseMessage=o.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage})})},changePage(d){this.getProducts(d)}},mounted(){this.getProducts()},components:{ProductModal:Ee,DelConfirmModal:E,PaginationComponent:N,PageLoading:O}},Oe={class:"container"},De={class:"productHeader d-flex align-items-center justify-content-between align-middle"},Le=e("h1",{class:"m-0"},"產品管理",-1),Fe={class:"table text-center align-middle"},Be=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"種類"),e("th",null,"名稱"),e("th",null,"原價"),e("th",null,"售價"),e("th",null,"庫存"),e("th",null,"編輯")])],-1),Se=["onClick"],qe=["onClick"];function Re(d,o,_,r,t,u){const a=g("iconify-icon"),c=g("PaginationComponent"),y=g("ProductModal"),V=g("DelConfirmModal"),i=g("PageLoading"),s=g("AlertModal");return p(),h(w,null,[e("div",Oe,[e("div",De,[Le,e("button",{type:"button",class:"btn btn-secondary float-end text-white align-items-center",onClick:o[0]||(o[0]=n=>{this.$refs.pModal.openModal(),this.product={},this.isNew=!0})},[l(a,{icon:"material-symbols:add"}),T(" 新增產品 ")])]),e("table",Fe,[Be,e("tbody",null,[(p(!0),h(w,null,I(t.products,n=>(p(),h("tr",{key:n.id},[e("th",null,b(n.id),1),e("td",null,b(n.category),1),e("td",null,b(n.title),1),e("td",null,b(n.origin_price),1),e("td",null,b(n.price),1),e("td",null,b(n.num),1),e("td",null,[e("button",{type:"button",class:"btn btn-secondary me-3",onClick:P=>{this.$refs.pModal.openModal(),this.product=JSON.parse(JSON.stringify(n)),this.isNew=!1}}," 編輯 ",8,Se),e("button",{type:"button",class:"btn btn-outline-primary",onClick:P=>{this.$refs.delModal.openModal(),t.message=`確定要刪除 ${n.title} 嗎?`,t.delFunc=u.deleteProduct.bind(this,n.id)}},"刪除",8,qe)])]))),128))])]),l(c,{pages:t.pagination,onChangePage:u.changePage},null,8,["pages","onChangePage"])]),l(y,{ref:"pModal",product:t.product,isNew:t.isNew,onUpdateProduct:u.updateProduct},null,8,["product","isNew","onUpdateProduct"]),l(V,{ref:"delModal",message:t.message,delFunc:t.delFunc},null,8,["message","delFunc"]),l(i,{active:t.loading},null,8,["active"]),l(s,{ref:"alertModal",message:t.responseMessage},null,8,["message"])],64)}const Ge=U(Ne,[["render",Re]]);export{Ge as default};
