import{_ as y,r as m,o as a,c as i,b as e,t as n,e as l,w as P,n as p,F as O,k as U,h as M,p as E,v as C,j as h}from"./index-9fd1a623.js";import{D as k,P as A,a as N}from"./PageLoading-bca768ad.js";const T={name:"orderModal",props:["order"],data(){return{modal:null,tempOrder:{products:{},user:{}}}},watch:{order:{handler(){this.tempOrder=JSON.parse(JSON.stringify(this.order))},deep:!0}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},submit(){this.$emit("update-order",this.tempOrder)}},mounted(){this.modal=new window.bootstrap.Modal(document.getElementById("orderModal"))}},D={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-lg"},L={class:"modal-content rounded-0"},S={class:"modal-header rounded-0 bg-secondary text-white"},$={class:"modal-title",id:"orderModalLabel"},q=e("button",{type:"button",class:"btn-close bg-white rounded-0","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),B={class:"modal-body"},I={class:"mb-3"},J=e("p",null,"訂購人",-1),R={class:"mb-3 d-flex justify-content-between"},j=e("label",{for:"orderUserName",class:"form-label"},"姓名",-1),H=e("label",{for:"orderUserEmail",class:"form-label"},"Email",-1),z=e("label",{for:"orderUserTel",class:"form-label"},"電話",-1),G=e("label",{for:"orderUserAddress",class:"form-label"},"地址",-1),K=e("hr",null,null,-1),Q={class:"mb-3"},W=e("p",null,"訂購商品",-1),X={class:"table text-center align-middle"},Y=e("thead",null,[e("tr",null,[e("th"),e("th",null,"商品名稱"),e("th",null,"數量"),e("th",null,"單價"),e("th",null,"小計")])],-1),Z={type:"button",class:"btn"},ee=e("td",{colspan:"4",class:"text-end"},"總計:",-1),se={class:"mb-3"},te=e("label",{for:"orderMessage",class:"form-label"},"顧客留言",-1),oe=["value"],le={class:"mb-3 d-flex justify-content-between align-items-center"},ne={class:"mb-0"},re={class:"d-flex align-items-center"},de=e("p",{class:"mb-0",style:{"min-width":"100px"}},"訂單狀態:",-1),ae=e("option",{value:"0"},"已成立",-1),ie=e("option",{value:"1"},"未處理",-1),me=e("option",{value:"2"},"已出貨",-1),ce=e("option",{value:"3"},"已完成",-1),ue=[ae,ie,me,ce],_e={class:"mb-0"},pe=e("hr",null,null,-1),he={class:"mb-3"},ge=e("label",{for:"messages",class:"form-label"},"店家留言",-1),be={class:"modal-footer"},fe=e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 ",-1);function ve(d,s,x,V,t,_){const c=m("VField"),u=m("ErrorMessage"),g=m("iconify-icon"),b=m("VForm");return a(),i("div",D,[e("div",F,[e("div",L,[e("div",S,[e("h5",$,"訂單編號: "+n(t.tempOrder.id),1),q]),e("div",B,[l(b,{onSubmit:_.submit},{default:P(({errors:r})=>[e("div",I,[J,e("div",R,[e("div",null,[j,l(c,{name:"orderUserName",modelValue:t.tempOrder.user.name,"onUpdate:modelValue":s[0]||(s[0]=o=>t.tempOrder.user.name=o),type:"text",class:p(["form-control",{"is-invalid":r.orderUserName,"is-valid":!r.orderUserName&&t.tempOrder.user.name}]),id:"orderUserName",rules:"required"},null,8,["modelValue","class"]),l(u,{name:"orderUserName"})]),e("div",null,[H,l(c,{name:"orderUserEmail",modelValue:t.tempOrder.user.email,"onUpdate:modelValue":s[1]||(s[1]=o=>t.tempOrder.user.email=o),type:"text",class:p(["form-control",{"is-invalid":r.orderUserEmail,"is-valid":!r.orderUserEmail&&t.tempOrder.user.email}]),id:"orderUserEmail",rules:"email|required"},null,8,["modelValue","class"]),l(u,{name:"orderUserEmail"})]),e("div",null,[z,l(c,{name:"orderUserTel",modelValue:t.tempOrder.user.tel,"onUpdate:modelValue":s[2]||(s[2]=o=>t.tempOrder.user.tel=o),type:"text",class:p(["form-control",{"is-invalid":r.orderUserTel,"is-valid":!r.orderUserTel&&t.tempOrder.user.tel}]),id:"orderUserTel",rules:"numeric|required"},null,8,["modelValue","class"]),l(u,{name:"orderUserTel"})])]),G,l(c,{name:"orderUserAddress",modelValue:t.tempOrder.user.address,"onUpdate:modelValue":s[3]||(s[3]=o=>t.tempOrder.user.address=o),type:"text",class:p(["form-control",{"is-invalid":r.orderUserAddress,"is-valid":!r.orderUserAddress&&t.tempOrder.user.address}]),id:"orderUserAddress",rules:"required"},null,8,["modelValue","class"]),l(u,{name:"orderUserAddress"})]),K,e("div",Q,[W,e("table",X,[Y,e("tbody",null,[(a(!0),i(O,null,U(t.tempOrder.products,o=>(a(),i("tr",{key:o.id},[e("td",null,[e("button",Z,[l(g,{icon:"material-symbols:delete-outline-sharp",class:"text-primary"})])]),e("td",null,n(o.product.title),1),e("td",null,n(o.qty),1),e("td",null,n(o.product.price),1),e("td",null,n(o.total),1)]))),128))]),e("tfoot",null,[e("tr",null,[ee,e("td",null,n(t.tempOrder.total),1)])])])]),e("div",se,[te,e("textarea",{name:"orderMessage",id:"orderMessage",class:"form-control",disabled:"",value:t.tempOrder.message},null,8,oe)]),e("div",le,[e("div",null,[e("p",ne,"總數量: "+n(t.tempOrder.num),1)]),e("div",re,[de,M(e("select",{"onUpdate:modelValue":s[4]||(s[4]=o=>t.tempOrder.status=o),class:"form-select",default:"0","aria-label":"Default select example"},ue,512),[[E,t.tempOrder.status]])]),e("p",_e,"付款狀態: "+n(t.tempOrder.is_paid?"已付款":"未付款"),1)]),pe,e("div",he,[ge,M(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=o=>t.tempOrder.messages=o),class:"form-control",id:"messages",rows:"3"},null,512),[[C,t.tempOrder.messages]])])]),_:1},8,["onSubmit"])]),e("div",be,[fe,e("button",{type:"button",class:"btn btn-secondary",onClick:s[6]||(s[6]=r=>{_.submit(),this.closeModal()})},"修改")])])])])}const Oe=y(T,[["render",ve]]);const{VITE_APP_URL:f,VITE_APP_PATH:v}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"int-hexschool",BASE_URL:"/hexvue-week7/",MODE:"production",DEV:!1,PROD:!0},Me={name:"OrdersView",data(){return{orders:[],order:{},pagination:{},message:"",delFunc:null,loading:!1,responseMessage:""}},methods:{getOrders(d=1){this.loading=!0,this.$http.get(`${f}/api/${v}/admin/orders?page=${d}`).then(s=>{this.loading=!1,this.orders=s.data.orders,this.pagination=s.data.pagination}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message})})},updateOrder(d){this.loading=!0,this.$http.put(`${f}/api/${v}/admin/order/${d.id}`,{data:d}).then(s=>{this.loading=!1,this.responseMessage=s.data.message,this.$swal.fire({icon:"success",title:"好耶",text:s.data.message}),this.getOrders()}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message})})},deleteOrder(d){this.loading=!0,this.$http.delete(`${f}/api/${v}/admin/order/${d}`).then(s=>{this.loading=!1,this.responseMessage=s.data.message,this.$swal.fire({icon:"success",title:"好耶",text:s.data.message}),this.getOrders()}).catch(s=>{this.loading=!1,this.responseMessage=s.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:s.response.data.message})})},changePage(d){this.getOrders(d)}},mounted(){this.getOrders()},components:{orderModal:Oe,DelConfirmModal:k,PaginationComponent:A,PageLoading:N}},ye={class:"container"},Ue=e("h1",null,"訂單管理",-1),xe={class:"table text-center align-middle"},Ve=e("thead",null,[e("tr",null,[e("th",null,"訂單編號"),e("th",null,"訂單成立日期"),e("th",null,"訂購人"),e("th",null,"價格"),e("th",null,"狀態"),e("th",null,"編輯")])],-1),we={key:0},Pe={key:1},Ee={key:2},Ce={key:3},ke=["onClick"],Ae=["onClick"];function Ne(d,s,x,V,t,_){const c=m("PaginationComponent"),u=m("orderModal"),g=m("DelConfirmModal"),b=m("PageLoading"),r=m("AlertModal");return a(),i(O,null,[e("div",ye,[Ue,e("table",xe,[Ve,e("tbody",null,[(a(!0),i(O,null,U(t.orders,o=>(a(),i("tr",{key:o.id},[e("th",null,n(o.id),1),e("td",null,n(o.create_at),1),e("td",null,n(o.user.name),1),e("td",null,n(o.total),1),o.status==0?(a(),i("td",we,"已成立 ")):h("",!0),o.status==1?(a(),i("td",Pe,"未處理")):h("",!0),o.status==2?(a(),i("td",Ee,"已出貨")):h("",!0),o.status==3?(a(),i("td",Ce,"已完成")):h("",!0),e("td",null,[e("button",{type:"button",class:"btn btn-secondary me-3",onClick:w=>{this.$refs.orderModal.openModal(),this.order=JSON.parse(JSON.stringify(o))}},"編輯",8,ke),e("button",{type:"button",class:"btn btn-outline-primary",onClick:w=>{this.$refs.delModal.openModal(),t.message=`確定要刪除訂單編號為${o.id}的訂單嗎?`,t.delFunc=_.deleteOrder.bind(this,o.id)}},"刪除",8,Ae)])]))),128))])]),l(c,{pages:t.pagination},null,8,["pages"])]),l(u,{ref:"orderModal",order:t.order,onUpdateOrder:_.updateOrder},null,8,["order","onUpdateOrder"]),l(g,{ref:"delModal",message:t.message,delFunc:t.delFunc},null,8,["message","delFunc"]),l(b,{active:t.loading},null,8,["active"]),l(r,{ref:"alertModal",message:t.responseMessage},null,8,["message"])],64)}const Fe=y(Me,[["render",Ne]]);export{Fe as default};
