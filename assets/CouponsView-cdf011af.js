import{_ as w,k as a,l as C,S as f,T as e,$ as u,U as s,V as x,X as _,a0 as P,R as D,Z as k,W as v,a2 as N}from"./index-5da66a8b.js";import{a as T}from"./authStore-613f6c38.js";import{a as $}from"./runtime-dom.esm-bundler-1924b5fb.js";import{P as E,D as A,a as U}from"./PageLoading-20c7d6dc.js";const F={name:"CouponModal",props:["coupon","isNew"],data(){return{modal:null,tempCoupon:{is_enabled:1}}},watch:{tempCoupon:{handler(){this.tempCoupon.is_enabled=this.tempCoupon.is_enabled?1:0},deep:!0},coupon:{handler(){this.tempCoupon=JSON.parse(JSON.stringify(this.coupon)),console.log("coupon",this.coupon)},deep:!0}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},submit(){this.$emit("update-coupon",this.tempCoupon)}},mounted(){this.modal=new window.bootstrap.Modal(document.getElementById("couponModal"))}},L={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},I={class:"modal-dialog"},S={class:"modal-content rounded-0"},B={class:"modal-header bg-secondary rounded-0"},R={class:"modal-title text-white",id:"exampleModalLabel"},q=e("button",{type:"button",class:"btn-close bg-white rounded-0","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},H={class:"row"},J={class:"col-12"},z={class:"mb-3"},W=e("label",{for:"couponTitle",class:"mb-2"},"優惠券名稱",-1),X={class:"mb-3"},Z=e("label",{for:"couponPercent",class:"form-label"},"折扣",-1),j={class:"mb-3"},G=e("label",{for:"couponDueDate",class:"form-label"},"到期日",-1),K={class:"mb-3"},Q=e("label",{for:"couponCode",class:"form-label"},"優惠代碼",-1),Y=["value"],ee=e("label",{class:"form-check-label",for:"orderIsEnabled"}," 是否啟用 ",-1),oe={class:"modal-footer"},te=e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 ",-1);function se(d,t,r,m,o,h){const c=a("VField"),p=a("ErrorMessage"),M=a("VForm");return C(),f("div",L,[e("div",I,[e("div",S,[e("div",B,[e("h5",R,u(r.isNew?"新增優惠券":`優惠券編號: ${o.tempCoupon.id}`),1),q]),e("div",O,[s(M,{onSubmit:h.submit},{default:x(({errors:n})=>[e("div",H,[e("div",J,[e("div",z,[W,s(c,{id:"couponTitle",name:"couponTitle",type:"text",rules:"required",class:_(["form-control mb-1",{"is-invalid":n.couponTitle,"is-valid":!n.couponTitle&&o.tempCoupon.title}]),placeholder:"請輸入產品名稱",modelValue:o.tempCoupon.title,"onUpdate:modelValue":t[0]||(t[0]=l=>o.tempCoupon.title=l)},null,8,["class","modelValue"]),s(p,{name:"couponTitle"})]),e("div",X,[Z,s(c,{name:"couponPercent",modelValue:o.tempCoupon.percent,"onUpdate:modelValue":t[1]||(t[1]=l=>o.tempCoupon.percent=l),modelModifiers:{number:!0},type:"number",min:"1",class:_(["form-control",{"is-invalid":n.couponPercent,"is-valid":!n.couponPercent&&o.tempCoupon.percent}]),id:"couponPercent",rules:"numeric|required"},null,8,["modelValue","class"]),s(p,{name:"couponPercent"})]),e("div",j,[G,s(c,{name:"couponDueDate",modelValue:o.tempCoupon.due_date,"onUpdate:modelValue":t[2]||(t[2]=l=>o.tempCoupon.due_date=l),modelModifiers:{number:!0},type:"number",class:_(["form-control",{"is-invalid":n.couponDueDate,"is-valid":!n.couponDueDate&&o.tempCoupon.udue_date}]),id:"couponDueDate",rules:"numeric|required"},null,8,["modelValue","class"]),s(p,{name:"couponDueDate"})]),e("div",K,[Q,s(c,{name:"couponCode",modelValue:o.tempCoupon.code,"onUpdate:modelValue":t[3]||(t[3]=l=>o.tempCoupon.code=l),type:"text",class:_(["form-control",{"is-invalid":n.couponCode,"is-valid":!n.couponCode&&o.tempCoupon.code}]),id:"couponCode",rules:"required"},null,8,["modelValue","class"]),s(p,{name:"couponCode"})]),e("div",null,[P(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>o.tempCoupon.is_enabled=l),class:"form-check-input me-2",type:"checkbox",value:o.tempCoupon.is_enabled,id:"orderIsEnabled"},null,8,Y),[[$,o.tempCoupon.is_enabled,void 0,{number:!0}]]),ee])])])]),_:1},8,["onSubmit"])]),e("div",oe,[te,e("button",{type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=n=>{h.submit(),this.closeModal()})},u(r.isNew?"新增":"修改"),1)])])])])}const ne=w(F,[["render",se]]);const{VITE_APP_URL:b,VITE_APP_PATH:g}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"int-hexschool",BASE_URL:"/hexvue-week7/",MODE:"production",DEV:!1,PROD:!0},le={name:"CouponsView",data(){return{coupons:{},coupon:{},pagination:{},isNew:!0,message:"",delFunc:null,loading:!1,responseMessage:""}},methods:{getCoupons(d=1){this.loading=!0,this.$http.get(`${b}/api/${g}/admin/coupons?page=${d}`).then(t=>{this.loading=!1,this.coupons=t.data.coupons,this.pagination=t.data.pagination}).catch(t=>{this.loading=!1,this.responseMessage=t.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage})})},updateCoupon(d){this.loading=!0;const t=this.isNew?`${b}/api/${g}/admin/coupon`:`${b}/api/${g}/admin/coupon/${d.id}`,r=this.isNew?"post":"put";this.$http[r](t,{data:d}).then(m=>{this.loading=!1,this.responseMessage=m.data.message,this.$swal.fire({icon:"success",title:"好耶",text:this.responseMessage}),this.getCoupons()}).catch(m=>{this.loading=!1,this.responseMessage=m.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage})})},deleteCoupon(d){this.loading=!0,this.$http.delete(`${b}/api/${g}/admin/coupon/${d}`).then(t=>{this.loading=!1,this.responseMessage=t.data.message,this.$swal.fire({icon:"success",title:"好耶",text:this.responseMessage}),this.getCoupons()}).catch(t=>{this.loading=!1,this.responseMessage=t.response.data.message,this.$swal.fire({icon:"error",title:"好像出了點錯誤",text:this.responseMessage})})},...D(T,["checkAuth"])},mounted(){this.checkAuth(),this.getCoupons()},components:{CouponModal:ne,Pagination:E,DeleteModal:A,PageLoading:U}},ie={class:"container"},ae=e("h1",null,"優惠券管理",-1),de={class:"table text-center align-middle"},ue=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"名稱"),e("th",null,"折扣"),e("th",null,"到期日"),e("th",null,"優惠碼"),e("th",null,"數量"),e("th",null,"編輯")])],-1),ce=["onClick"],pe=["onClick"];function re(d,t,r,m,o,h){const c=a("iconify-icon"),p=a("CouponModal"),M=a("DeleteModal"),n=a("Pagination"),l=a("PageLoading"),V=a("AlertModal");return C(),f(v,null,[e("div",ie,[ae,e("button",{type:"button",class:"btn btn-secondary float-end text-white align-items-center",onClick:t[0]||(t[0]=i=>{this.$refs.cModal.openModal(),this.coupon={},this.isNew=!0})},[s(c,{icon:"material-symbols:add"}),k(" 新增產品 ")]),e("table",de,[ue,e("tbody",null,[(C(!0),f(v,null,N(o.coupons,i=>(C(),f("tr",{key:i.id},[e("td",null,u(i.id),1),e("td",null,u(i.title),1),e("td",null,u(i.percent),1),e("td",null,u(i.due_date),1),e("td",null,u(i.code),1),e("th",null,u(i.num),1),e("td",null,[e("button",{class:"btn btn-secondary me-3",onClick:y=>{this.$refs.cModal.openModal(),this.coupon=i,this.isNew=!1}},"編輯",8,ce),e("button",{class:"btn btn-outline-primary",onClick:y=>{this.$refs.delModal.openModal(),o.message=`確定要刪除優惠券${i.title}嗎?`,o.delFunc=h.deleteCoupon.bind(this,i.id)}},"刪除",8,pe)])]))),128))])])]),s(p,{ref:"cModal",coupon:o.coupon,isNew:o.isNew,onUpdateCoupon:h.updateCoupon},null,8,["coupon","isNew","onUpdateCoupon"]),s(M,{ref:"delModal",message:o.message,delFunc:o.delFunc},null,8,["message","delFunc"]),s(n,{pages:o.pagination},null,8,["pages"]),s(l,{active:o.loading},null,8,["active"]),s(V,{ref:"alertModal",message:o.responseMessage},null,8,["message"])],64)}const ge=w(le,[["render",re]]);export{ge as default};
