import{Y as T,x as v,R as V,_ as D,k as c,l as b,S as C,T as o,$ as u,U as a,V as k,X as r,a0 as E,a3 as N,Z as S,W as $,a2 as A}from"./index-c7ac2ae7.js";import{a as U}from"./authStore-73a8521f.js";import{a as x}from"./runtime-dom.esm-bundler-b3e904ff.js";const{VITE_APP_URL:_,VITE_APP_PATH:h}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"int-hexschool",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},g=T("couponStore",{state:()=>({coupons:[]}),actions:{getCoupons(n=1){v.get(`${_}/api/${h}/admin/coupons?page=${n}`).then(e=>{this.coupons=e.data.coupons,console.log(this.coupons)}).catch(e=>{alert(e.response.data.message)})},updateCoupon(n,e){const p=e?`${_}/api/${h}/admin/coupon`:`${_}/api/${h}/admin/coupon/${n.id}`;v[e?"post":"put"](p,{data:n}).then(t=>{alert(t.data.message),this.getCoupons()}).catch(t=>{alert(t.response.data.message)})},deleteCoupon(n){v.delete(`${_}/api/${h}/admin/coupon/${n}`).then(e=>{alert(e.data.message),this.getCoupons()}).catch(e=>{alert(e.response.data.message)})}}}),I={name:"CouponModal",props:["coupon","isNew"],data(){return{modal:null,tempCoupon:{is_enabled:1}}},watch:{coupon:{handler(){this.tempCoupon=JSON.parse(JSON.stringify(this.coupon)),this.tempCoupon.is_enabled=this.tempCoupon.is_enabled?1:0,console.log("coupon",this.coupon)},deep:!0}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},...V(g,["updateCoupon"])},mounted(){this.modal=new window.bootstrap.Modal(document.getElementById("couponModal"))}},F={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},L={class:"modal-dialog"},B={class:"modal-content rounded-0"},R={class:"modal-header"},q={class:"modal-title",id:"exampleModalLabel"},O=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},J={class:"row"},z={class:"col-12"},W={class:"mb-3"},X=o("label",{for:"couponTitle",class:"mb-2"},"優惠券名稱",-1),Y={class:"mb-3"},Z=o("label",{for:"couponPercent",class:"form-label"},"折扣",-1),j={class:"mb-3"},G=o("label",{for:"couponDueDate",class:"form-label"},"到期日",-1),K={class:"mb-3"},Q=o("label",{for:"couponCode",class:"form-label"},"優惠代碼",-1),oo=["value"],eo=o("label",{class:"form-check-label",for:"orderIsEnabled"}," 是否啟用 ",-1),to={class:"modal-footer"},no=o("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 ",-1);function so(n,e,p,y,t,P){const i=c("VField"),d=c("ErrorMessage"),m=c("VForm");return b(),C("div",F,[o("div",L,[o("div",B,[o("div",R,[o("h5",q,u(),1),O]),o("div",H,[a(m,{onSubmit:n.submit},{default:k(({errors:s})=>[o("div",J,[o("div",z,[o("div",W,[X,a(i,{id:"couponTitle",name:"couponTitle",type:"text",rules:"required",class:r(["form-control mb-1",{"is-invalid":s.couponTitle,"is-valid":!s.couponTitle&&t.tempCoupon.title}]),placeholder:"請輸入產品名稱",modelValue:t.tempCoupon.title,"onUpdate:modelValue":e[0]||(e[0]=l=>t.tempCoupon.title=l)},null,8,["class","modelValue"]),a(d,{name:"couponTitle"})]),o("div",Y,[Z,a(i,{name:"couponPercent",modelValue:t.tempCoupon.percent,"onUpdate:modelValue":e[1]||(e[1]=l=>t.tempCoupon.percent=l),modelModifiers:{number:!0},type:"number",min:"1",class:r(["form-control",{"is-invalid":s.couponPercent,"is-valid":!s.couponPercent&&t.tempCoupon.percent}]),id:"couponPercent",rules:"numeric|required"},null,8,["modelValue","class"]),a(d,{name:"couponPercent"})]),o("div",j,[G,a(i,{name:"couponDueDate",modelValue:t.tempCoupon.due_date,"onUpdate:modelValue":e[2]||(e[2]=l=>t.tempCoupon.due_date=l),modelModifiers:{number:!0},type:"number",class:r(["form-control",{"is-invalid":s.couponDueDate,"is-valid":!s.couponDueDate&&t.tempCoupon.udue_date}]),id:"couponDueDate",rules:"numeric|required"},null,8,["modelValue","class"]),a(d,{name:"couponDueDate"})]),o("div",K,[Q,a(i,{name:"couponCode",modelValue:t.tempCoupon.code,"onUpdate:modelValue":e[3]||(e[3]=l=>t.tempCoupon.code=l),type:"text",class:r(["form-control",{"is-invalid":s.couponCode,"is-valid":!s.couponCode&&t.tempCoupon.code}]),id:"couponCode",rules:"required"},null,8,["modelValue","class"]),a(d,{name:"couponCode"})]),o("div",null,[E(o("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.tempCoupon.is_enabled=l),class:"form-check-input me-2",type:"checkbox",value:t.tempCoupon.is_enabled,id:"orderIsEnabled"},null,8,oo),[[x,t.tempCoupon.is_enabled]]),eo])])])]),_:1},8,["onSubmit"])]),o("div",to,[no,o("button",{type:"button",class:"btn btn-secondary",onClick:e[5]||(e[5]=s=>n.updateCoupon(t.tempCoupon))},u(p.isNew?"新增":"修改"),1)])])])])}const lo=D(I,[["render",so]]);const ao={name:"CouponsView",data(){return{isNew:!0,message:"",delFunc:null}},computed:{...N(g,["coupons"])},methods:{...V(U,["checkAuth"]),...V(g,["getCoupons"])},mounted(){this.checkAuth(),this.getCoupons(),console.log("coupon in View:",this.coupons)},components:{CouponModal:lo}},uo={class:"container"},io=o("h1",null,"優惠券管理",-1),co={class:"table align-middle"},po=o("th",null,null,-1),mo=o("th",null,"名稱",-1),ro=o("th",null,"折扣",-1),_o=o("th",null,"到期日",-1),ho=o("th",null,"優惠碼",-1),bo=o("th",null,"編輯",-1),Co=[po,mo,ro,_o,ho,bo],fo=o("button",{class:"btn btn-outline-primary"},"刪除",-1);function vo(n,e,p,y,t,P){var m,s,l,M,w;const i=c("iconify-icon"),d=c("CouponModal");return b(),C($,null,[o("div",uo,[io,o("button",{type:"button",class:"btn btn-secondary float-end text-white align-items-center",onClick:e[0]||(e[0]=f=>{this.$refs.cModal.openModal(),this.coupon={},this.isNew=!0})},[a(i,{icon:"material-symbols:add"}),S(" 新增產品 ")]),o("table",co,[o("thead",null,[(b(!0),C($,null,A(n.coupons,f=>(b(),C("tr",{key:f.id},Co))),128))]),o("tbody",null,[o("tr",null,[o("th",null,u((m=n.coupon)==null?void 0:m.id),1),o("td",null,u((s=n.coupon)==null?void 0:s.title),1),o("td",null,u((l=n.coupon)==null?void 0:l.percent),1),o("td",null,u((M=n.coupon)==null?void 0:M.due_date),1),o("td",null,u((w=n.coupon)==null?void 0:w.code),1),o("td",null,[o("button",{class:"btn btn-secondary me-3",onClick:e[1]||(e[1]=f=>{this.$refs.cModal.openModal(),this.coupon=n.coupon,this.isNew=!1})},"編輯"),fo])])])])]),a(d,{ref:"cModal",coupon:n.coupon,isNew:t.isNew},null,8,["coupon","isNew"])],64)}const Mo=D(ao,[["render",vo]]);export{Mo as default};
